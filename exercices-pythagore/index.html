<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Exercices sur le théorème de Pythagore</title>
  <style>
    /* Styles de base */
    body {
      font-family: Arial, sans-serif;
      background-color: #f0f0f0;
      margin: 0;
      padding: 20px;
    }
    .container {
      max-width: 800px;
      margin: auto;
      background-color: #fff;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
    }
    h1, h2 {
      text-align: center;
    }
    .score {
      font-weight: bold;
      font-size: 1.2em;
      text-align: center;
      margin-bottom: 20px;
    }
    .question {
      margin-bottom: 20px;
      line-height: 1.6;
    }
    input[type="text"] {
      width: calc(100% - 22px);
      padding: 10px;
      font-size: 1em;
      margin-bottom: 10px;
    }
    button {
      padding: 10px 20px;
      font-size: 1em;
      cursor: pointer;
      margin: 5px;
    }
    .feedback {
      margin-top: 10px;
      font-weight: bold;
    }
    .feedback.error {
      color: #d00;
    }
    .feedback.correct {
      color: #080;
    }
    /* Texte caché : blanc sur blanc, taille réduite */
    .hidden-text {
      color: white;
      background-color: white;
      font-size: 1px;
      user-select: none;
    }
    /* Animation "pop" déjà présente */
    @keyframes pop {
      0% {
        transform: scale(0.5);
        opacity: 0;
      }
      50% {
        transform: scale(1.2);
        opacity: 1;
      }
      100% {
        transform: scale(1);
      }
    }
    /* Autres animations */
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    @keyframes rotate {
      from { transform: rotate(0deg) scale(0.5); }
      to { transform: rotate(360deg) scale(1); }
    }
    @keyframes bounce {
      0% { transform: translateY(0); }
      30% { transform: translateY(-15px); }
      50% { transform: translateY(0); }
      70% { transform: translateY(-7px); }
      100% { transform: translateY(0); }
    }
    @keyframes slideIn {
      from { transform: translateX(-100%); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }
    /* Classes d'animation */
    .animate-pop { animation: pop 0.5s ease-out; }
    .animate-fade { animation: fadeIn 0.5s ease-out; }
    .animate-rotate { animation: rotate 0.5s ease-out; }
    .animate-bounce { animation: bounce 0.5s ease-out; }
    .animate-slide { animation: slideIn 0.5s ease-out; }
    /* Styles pour la section récap */
    #recap {
      margin-top: 20px;
      border-top: 2px solid #ccc;
      padding-top: 20px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
    }
    table, th, td {
      border: 1px solid #aaa;
    }
    th, td {
      padding: 8px;
      text-align: center;
    }
    /* Section des contrôles */
    #controls {
      text-align: center;
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Exercices sur le théorème de Pythagore</h1>
    <div class="score">
      Score : <span id="score">0</span> / 100
    </div>
    <div id="exercise-container">
      <!-- Les exercices seront affichés ici -->
    </div>

    <!-- Boutons de contrôle -->
    <div id="controls">
      <button id="recap-btn">Afficher Récap</button>
      <button id="save-btn">Sauvegarder Progression</button>
      <button id="restore-btn">Restaurer Progression</button>
    </div>

    <!-- Section récapitulatif -->
    <div id="recap" style="display: none;">
      <h2>Récapitulatif</h2>
      <table>
        <thead>
          <tr>
            <th>Exercice</th>
            <th>Votre réponse</th>
            <th>Points</th>
            <th>État</th>
          </tr>
        </thead>
        <tbody id="recap-body">
          <!-- Le contenu sera généré -->
        </tbody>
      </table>
    </div>
  </div>

  <script>
    // Définition des exercices
    const exercises = [
      {
        question: `
          <strong>Exercice 1 : Calcul de l'hypoténuse</strong><br>
          Dans le triangle <em>ABC</em> rectangle en B, les côtés AB = 6 cm et BC = 8 cm.<br>
          Calcule la longueur de AC.
        `,
        type: "number",
        answer: 10,
        tolerance: 0.01,
        points: 15
      },
      {
        question: `
          <strong>Exercice 2 : Calcul d'un côté</strong><br>
          Dans le triangle <em>DEF</em>, rectangle en E, on connaît :<br>
          - DF = 10 cm (hypoténuse)<br>
          - DE = 6 cm<br>
          Calcule la longueur du côté EF.
        `,
        type: "number",
        answer: 8,
        tolerance: 0.01,
        points: 15
      },
      {
        question: `
          <strong>Exercice 3 : Problème avec une échelle</strong><br>
          Une échelle de 5 m est posée contre un mur. Le bas de l’échelle est à 3 m du pied du mur.<br>
          À quelle hauteur l’échelle touche-t-elle le mur ? (Arrondir au dixième)
        `,
        type: "number",
        answer: 4,
        tolerance: 0.1,
        points: 15
      },
      {
        question: `
          <strong>Exercice 4 : Vrai ou faux ?</strong><br>
          Dans un triangle <em>GHI</em>, on donne les longueurs suivantes :<br>
          - GH = 7 cm<br>
          - HI = 24 cm<br>
          - GI = 25 cm<br>
          Détermine si ce triangle est rectangle en vérifiant l’égalité du théorème de Pythagore.<br>
          Réponds par "Vrai" ou "Faux".
        `,
        type: "text",
        answer: "vrai",
        points: 15
      },
      {
        question: `
          <strong>Exercice 5 : Distance entre deux points</strong><br>
          Les coordonnées des points A et B sont respectivement A(2, 3) et B(8, 6).<br>
          Calcule la distance entre ces deux points en utilisant le théorème de Pythagore.
        `,
        type: "number",
        answer: Math.sqrt(Math.pow(8-2, 2) + Math.pow(6-3, 2)), // sqrt(36+9) ≈ 6.708
        tolerance: 0.1,
        points: 15
      },
      {
        question: `
          <strong>Exercice 6 : Terrain de football</strong><br>
          Un terrain de football mesure 90 m de long et 45 m de large.<br>
          On veut tendre une corde en diagonale entre deux coins opposés du terrain.<br>
          Quelle doit être la longueur de la corde ?
        `,
        type: "number",
        answer: Math.sqrt(90*90 + 45*45), // ≈ 100.623
        tolerance: 0.1,
        points: 15
      },
      {
        question: `
          <strong>Exercice 7 : Application au triangle équilatéral</strong><br>
          On a un triangle équilatéral de côté 10 cm.<br>
          Calcule la hauteur de ce triangle en utilisant le théorème de Pythagore.
        `,
        type: "number",
        answer: Math.sqrt(10*10 - Math.pow(10/2, 2)), // sqrt(100-25)=sqrt75 ≈ 8.66
        tolerance: 0.1,
        points: 10
      }
    ];

    let currentExercise = 0;
    let totalScore = 0;
    // Tableau qui contiendra le récapitulatif de chaque réponse
    let userResponses = [];

    const exerciseContainer = document.getElementById("exercise-container");
    const scoreDisplay = document.getElementById("score");
    const recapBtn = document.getElementById("recap-btn");
    const saveBtn = document.getElementById("save-btn");
    const restoreBtn = document.getElementById("restore-btn");
    const recapSection = document.getElementById("recap");
    const recapBody = document.getElementById("recap-body");

    // Fonction pour générer une chaîne aléatoire (watermark)
    function generateWatermark() {
      const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
      let str = '';
      for (let i = 0; i < 10; i++) {
        str += chars.charAt(Math.floor(Math.random() * chars.length));
      }
      return str;
    }

    // Fonction pour charger un exercice et y ajouter une watermark invisible
    function loadExercise(index) {
      if (index >= exercises.length) {
        // Fin des exercices
        exerciseContainer.innerHTML = `
          <h2>Félicitations !</h2>
          <p>Vous avez terminé tous les exercices.<br>
             Score final : ${totalScore} / 100.
          </p>
        `;
        updateRecap(); // Affiche le récap complet
        return;
      }

      const ex = exercises[index];
      // Ajout d'une watermark (texte invisible)
      const watermark = `<span class="hidden-text">${generateWatermark()}</span>`;
      exerciseContainer.innerHTML = `
        <div class="question">
          ${ex.question} ${watermark}
        </div>
        <input type="text" id="user-answer" placeholder="Votre réponse">
        <button id="submit-btn">Vérifier</button>
        <div class="feedback" id="feedback"></div>
      `;

      document.getElementById("submit-btn").addEventListener("click", function() {
        checkAnswer(ex);
      });
    }

    // Fonction de vérification de la réponse
    function checkAnswer(ex) {
      const userAnswer = document.getElementById("user-answer").value.trim();
      const feedback = document.getElementById("feedback");

      if (userAnswer === "") {
        feedback.textContent = "Veuillez entrer une réponse.";
        feedback.className = "feedback error";
        return;
      }

      let isCorrect = false;

      if (ex.type === "number") {
        // Autoriser la virgule comme séparateur décimal
        const userValue = parseFloat(userAnswer.replace(',', '.'));
        if (isNaN(userValue)) {
          feedback.textContent = "Veuillez entrer un nombre valide.";
          feedback.className = "feedback error";
          return;
        }
        if (Math.abs(userValue - ex.answer) <= ex.tolerance) {
          isCorrect = true;
        }
      } else if (ex.type === "text") {
        if (userAnswer.toLowerCase() === ex.answer.toLowerCase()) {
          isCorrect = true;
        }
      }

      // Sauvegarder la réponse dans le récapitulatif
      userResponses[currentExercise] = {
        question: ex.question.replace(/<[^>]*>/g, ''), // suppression des balises HTML
        userAnswer: userAnswer,
        isCorrect: isCorrect,
        points: isCorrect ? ex.points : 0
      };

      // Choix aléatoire d'une animation parmi plusieurs
      const animations = ["animate-pop", "animate-fade", "animate-rotate", "animate-bounce", "animate-slide"];
      const randomAnimation = animations[Math.floor(Math.random() * animations.length)];

      if (isCorrect) {
        totalScore += ex.points;
        scoreDisplay.textContent = totalScore;
        feedback.textContent = "Bonne réponse !";
        feedback.className = "feedback correct " + randomAnimation;
        // Retirer l'animation après 500 ms
        setTimeout(() => {
          feedback.classList.remove(randomAnimation);
        }, 500);
        // Passage à l'exercice suivant après un délai
        setTimeout(() => {
          currentExercise++;
          loadExercise(currentExercise);
        }, 1000);
      } else {
        feedback.textContent = "Mauvaise réponse, réessaye !";
        feedback.className = "feedback error";
      }
      // Met à jour le récapitulatif après chaque réponse
      updateRecap();
    }

    // Fonction de mise à jour du récapitulatif
    function updateRecap() {
      recapBody.innerHTML = "";
      userResponses.forEach((resp, idx) => {
        if (resp) {
          const row = document.createElement("tr");
          row.innerHTML = `
            <td>${idx + 1}</td>
            <td>${resp.userAnswer}</td>
            <td>${resp.points}</td>
            <td>${resp.isCorrect ? "Correct" : "Faux"}</td>
          `;
          recapBody.appendChild(row);
        }
      });
    }

    // Fonction pour afficher ou masquer le récapitulatif
    function toggleRecap() {
      if (recapSection.style.display === "none") {
        recapSection.style.display = "block";
      } else {
        recapSection.style.display = "none";
      }
    }

    // Fonction pour sauvegarder la progression sous forme d'une chaîne encodée en Base64
    function saveProgress() {
      const progress = {
        currentExercise,
        totalScore,
        userResponses
      };
      const jsonStr = JSON.stringify(progress);
      const encoded = btoa(jsonStr);
      prompt("Copiez cette chaîne pour sauvegarder votre progression :", encoded);
    }

    // Fonction pour restaurer la progression depuis une chaîne encodée en Base64
    function restoreProgress() {
      const data = prompt("Collez votre sauvegarde de progression :");
      try {
        const jsonStr = atob(data);
        const progress = JSON.parse(jsonStr);
        currentExercise = progress.currentExercise;
        totalScore = progress.totalScore;
        userResponses = progress.userResponses;
        scoreDisplay.textContent = totalScore;
        loadExercise(currentExercise);
        updateRecap();
      } catch (e) {
        alert("Données de progression invalides !");
      }
    }

    // Ajout des écouteurs sur les boutons de contrôle
    recapBtn.addEventListener("click", toggleRecap);
    saveBtn.addEventListener("click", saveProgress);
    restoreBtn.addEventListener("click", restoreProgress);

    // Démarrage avec le premier exercice
    loadExercise(currentExercise);
  </script>
</body>
</html>
